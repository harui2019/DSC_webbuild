<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title> DSC website </title>

    <!-- icon and css -->
    <link rel="icon" href="./webpage_icon_demo.svg">
    <!-- <link rel="stylesheet" href="./webfile_plugin1.css"> -->
    <link href="style.css" rel="stylesheet">

    <!-- mod import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" charset="utf-8"></script>
    <script src="./jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js" charset="utf-8"></script>
    <script src="https://rawgit.com/neveldo/jQuery-Mapael/master/js/jquery.mapael.js" charset="utf-8"></script>
    <!-- <script src="https://rawgit.com/aterrien/jQuery-Knob/master/dist/jquery.knob.min.js" charset="utf-8"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-browser/0.1.0/jquery.browser.min.js" charset="utf-8"></script>
    
    <!-- map file -->
    <script src="./twmapdot1_mapeal.js" charset="utf-8"></script>

    <!-- main of js mapeal -->
    <script type="text/javascript">
        console.log($.browser);
        console.log($.browser.name);

		var loading = {areas: {}, legends: {}, plots:{}};
        var pathjson = ["dataset_area1.json", "dataset_legend1.json", "dataset_plot1.json"];
        var loading2 = ["areas", "legends", "plots"];

        console.log("The pathjson has", pathjson, Object.keys(pathjson).length);
        console.log("The loading2 has", loading2);

		for (let i=0; i<Object.keys(pathjson).length; i++) {
            if ($.browser.name == "msie") {
            break;
        }
            $.getJSON(pathjson[i], function(obj) {
                console.log("start loading...");
                loading[loading2[i]] = obj;
                console.log(obj);
                console.log(i, pathjson[i], loading2[i]);
                console.log(loading2[i] + " is loading from " + pathjson[i] + " ...");
            })
            .done(function() {
                console.log(loading2[i] + " loaded successfully\n" + "##########");
            })
			.fail(function() {
				console.log(loading2[i] + " has error occur\n" + "!!!!!!!!!!");
            })
        };
        //hint: getJSON has a problem in for-loop which, 
        //please use "let" instead of "var".

        //Due to "let" make var. locally exist in current block and will recreate in each iteration,
        //and "var" make var. exist globally exist and will corrupt each iteration,
        //this made var. directly become the value of end of loop
        //getJSON will only get the such latest value of var.,
        //and there is an unwanted output.
        
        // WHY YOU STILL USE IE???
        // for those old explorer
        if ($.browser.name == "msie") {
            console.log("IS THIS A IE????");
        
            for (var i=0; i<Object.keys(pathjson).length; i++) {
                (function (i) {
                    $.getJSON(pathjson[i], function(obj) {
                        console.log("start loading...");
                        loading[loading2[i]] = obj;
                        console.log(obj);
                        console.log(i, pathjson[i], loading2[i]);
                        console.log(loading2[i] + " is loading from " + pathjson[i] + " ...");
                    })
                    .done(function() {
                        console.log(loading2[i] + " loaded successfully\n" + "##########");
                    })
                    .fail(function() {
                        console.log(loading2[i] + " has error occur\n" + "!!!!!!!!!!");
                    });
                })(i);
            }
        }


        //loading check
        console.log("Ground control to mapeal");
        console.log("loading", loading);

        $(function () {
            //set the data of mapeal
			var mapealdata = {
				map: {
                    name: "twmapdot1_mapeal",
                    defaultArea: {
                        attrs: {
                            fill: "#7c7c7c",
                            stroke: "#fff", "stroke-width": 1.0,
                            cursor: "pointer"
                        },
                        attrsHover: {
                            fill: "#B7B7B7",
                            stroke: "#fff", "stroke-width": 2.0
                        },
                        eventHandlers: {
                            click: function (e, id) {
                                //when you click, do following setting
                                $(".twmap").trigger('zoom', {
                                    area: id,
                                    areaMargin: 20
                                });
                            }
                        }
                    },
                    defaultPlot: {
                        attrs: {
                                fill: "#ffa000",
                                stroke: "#fff", "stroke-width": 1.0
                        },
                        attrsHover: {
                                fill: "#ffa000",
                                stroke: "#fff", "stroke-width": 2.0
                        },
                        text: {
                            attrs: {
                                fill: "#b4b4b4",
                                "font-weight": "normal"
                            },
                            attrsHover: {
                                fill: "#fff",
                                "font-weight": "bold"
                            }
                        }
                    },
                    zoom: {
                        enabled: true,
                        step: 0.25,
                        maxLevel: 20
                    }
                },
                legend: {},
				areas: {},
                plots: {
                    "paris": {
                        "x": 48.86,
                        "y": 2.3444,
                        "text": {
                            "position": "left",
                            "content": "Paris"
                        },
                    }
                }
            }
            //Loading the json data into specific var. on mapeal 
            mapealdata.areas = loading["areas"];
            mapealdata.legend = loading["legends"];
            //mapealdata.plots = loading["plots"];
            //data loading check
            console.log("This is mapeal to ground control");
            console.log("areas:", mapealdata.areas);
            console.log("legend:", mapealdata.legend);
            console.log("plots:", mapealdata.plots);
            // Mapael initialisation
            $(".twmap").mapael(mapealdata);
		})
    </script>
    </head>

    <body>
    <script src="./script.js"></script>

 <!-- <div class="anim"> -->
    <div class="imgbox">
        <img class="center-fit" id="ground" src = "img/ground0.png">
        
    </div>
    <img  id="excavator" src="img/excavator_up.png" data-img="img/excavator_up.png">
    <!-- <h1>webfile_2</h1> -->
    <div class="container">
        <div class="twmap mapael">
            <div class="map">
				<object type="image/svg+xml" src="./twmapdot1.svg" >
                    you shouldn't see this line, if you do, please refresh the web.
                    this line is made to check whether svg loaded successfully.
                    Since it's behind it.
					<!-- so, this indent is made to put a object as svg -->
				</object>
                <div class="mapTooltip" style="display: none; left: -1000px; top: -1000px;">
                </div>
                <div class="zoomButton zoomReset" title="Reset zoom">•</div>
                <div class="zoomButton zoomIn" title="Zoom in">+</div>
                <div class="zoomButton zoomOut" title="Zoom out">−</div>
            </div>
        </div>
    </div>
</body></html>
